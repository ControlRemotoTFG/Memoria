%---------------------------------------------------------------------
%
%                          Cap�tulo 4
%
%---------------------------------------------------------------------
%
% 04Imagenes.tex
% Copyright 2009 Marco Antonio Gomez-Martin, Pedro Pablo Gomez-Martin
%
% This file belongs to the TeXiS manual, a LaTeX template for writting
% Thesis and other documents. The complete last TeXiS package can
% be obtained from http://gaia.fdi.ucm.es/projects/texis/
%
% Although the TeXiS template itself is distributed under the 
% conditions of the LaTeX Project Public License
% (http://www.latex-project.org/lppl.txt), the manual content
% uses the CC-BY-SA license that stays that you are free:
%
%    - to share & to copy, distribute and transmit the work
%    - to remix and to adapt the work
%
% under the following conditions:
%
%    - Attribution: you must attribute the work in the manner
%      specified by the author or licensor (but not in any way that
%      suggests that they endorse you or your use of the work).
%    - Share Alike: if you alter, transform, or build upon this
%      work, you may distribute the resulting work only under the
%      same, similar or a compatible license.
%
% The complete license is available in
% http://creativecommons.org/licenses/by-sa/3.0/legalcode
%
%---------------------------------------------------------------------

\chapter{Arquitectura}
\label{cap4}
\label{cap:arquitectura}


\begin{FraseCelebre}
\begin{Frase}
%El alma nunca piensa sin una imagen mental.
\end{Frase}
\begin{Fuente}
%Arist�teles
\end{Fuente}
\end{FraseCelebre}

\begin{resumen}

\end{resumen}

%-------------------------------------------------------------------
\section{Arquitectura General}
%-------------------------------------------------------------------
\label{cap4:sec:arquitectura_general}
Desde el punto del desarrolador, para poder utilizar esta herramienta va a ser necesario tener la versi\'on XX.XX de Unity3D y Android Studio en su versi\'on XX.XX y un tel\'efono m\'ovil que podamos utilizar como emulador.
\\
Esta herramienta tiene 2 partes que est\'an diferenciadas por la plataforma para las que van destinadas. En el lado de PC, se ha implementado una serie de clases que son independientes al juego. 
Estas clases est\'an escritas en C\# y utilizan las librer\'ias  nativas de red de este lenguaje para comunicaci\'on. Por encima de estas clases se encuentra la parte espec\'ifica de Unity3D que facilita su uso. 
\\
Como parte extra a la herramienta, se ha propuesto un inicio de conexi\'on a trav\'es de la lectura de un QR. Con esto lo que se pretende es enlazar el dispositivo Android con el juego que se est\'a ejecutando en Unity. 
La lectura de este QR se hace directamente desde la aplicaci\'on creada para este proyecto. Al leer el QR y emparejarse ambos dispositivos, la aplicaci\'on Android cambia de c\'amara a mando.
\\

[INSERTE IMAGEN DE ARQUITECTURA Y DIAGRAMA DE CLASES Y COMPONENTES  + EXPLICACION]


%-------------------------------------------------------------------
\section{Protocolo de conexi\'on}
%-------------------------------------------------------------------
\label{cap4:sec:protocolo}

La conexi\'on se incia con la lectura de un QR que se mostrar\'a en el juego ejecutado en Unity. Una vez el dispositivo Android haya leido ese QR, Android manda la resoluci\'on del dispositivo con 2 bytes. 
El servidor que se est\'a ejecutando en Unity, guarda esa informaci\'on y escala el mando que se haya seleccionado a la resoluci\'on que tiene el dispositivo Android. Una vez hecho esto, se calculan las coordenadas de los botones del mando y se pasan a un XML.
\\
Este XML junto a la imagen es enviado al dispositivo Android. El tel\'efono guarda esta informaci\'on y deja de mostrar la c\'amara para mostrar la imagen del mando que se le ha enviado. En la aplicaci\'on Android han quedado guardadas las coordenadas de los botones, por lo que ya podr\'ia empezar la sesi\'on de juego.
\\
Durante una sesi\'on de juego estandar, el dispositivo Android recibir\'a pulsaciones del jugador en la pantalla, calcular\'a el bot\'on al que corresponde y enviar\'a al ordenador un array de 10 bytes en los que ir\'a la informaci\'on necesaria para saber la acci\'on que ha hecho el jugador y reaccionar consecuentemente.
\\

[ADJUNTAR IMAGEN DESCRIPTIVA DEL CONTENIDO DEL ARRAY + POSTERIOR EXPLICACION DEL SIGNIFICADO DE CADA COSA Y LOS VALORES QUE PUEDE TOMAR]

%-------------------------------------------------------------------
\section{El uso de los QR para inicio de conexi\'on}
%-------------------------------------------------------------------
\label{cap4:QR}

Los QR's son los c\'odigos de barras 2D, la raz\'on por la que se ha elegido esta tecnolog\'ia para sincronizar el dispositivo Android con el juego en ejecuci\'on en Unity es debido a que es una tecnolog\'ia que ambos sistemas saben interpretar y porque actualmente es un est\'andar, a parte nuestro usuarios ya tienen el propio dispositivo m\'ovil en sus manos listo para sincronizar y pasar a ser su mando. En la mayor parte de ocasiones, este contenido es una URL espec\'ifica, en el caso de este proyecto, lo que contiene el QR es la direcci\'ion IP del equipo que est\'a ejecutando el juego de Unity. A su vez contiene el puerto donde el dispositivo Android debe conectarse y mandar sus mensajes. Una vez leido el QR, la aplicaci\'on Android guarda estos datos para que el juego pueda comenzar y el QR pueda desaparecer. 
\\

%-------------------------------------------------------------------
\section{Pantalla secundaria y controlador}
%-------------------------------------------------------------------
\label{cap4:pantallasecundaria}

Como se dijo en el cap\'itulo 2, para este proyecto se ha usado de referencia las consolas Wii U de Nintendo y PlayLink de Sony. Se quiere que los desarrolladores de los juegos hecho en Unity pudiesen mostrar elementos del juego como un mapa, un inventario o unas notas que seguir fuera del HUD de juego para que este no se viese saturado.
\\
Es por esta idea, por lo que a la aplicaci\'on de Android se le ha dado la capacidad de recibir im\'agenes y mostrarlas por la pantalla del Android. Con esto se da la posibilidad de enviar una im\'agen que ya haya sido creada con anterioridad o incluso se abre la posibilidad de enviar lo que est\'a renderizando una c\'amara dentro del juego en tiempo real y hacer que nuestro dispositivo Android lo muestre. 
\\
Esto lo que implica es que la comuncicaci\'on entre la aplicaci\'on Android y el juego de Unity va a ser constante y se corre el riesgo de saturar la red. Para solventar este posible fallo, se decidi\'o comprimir la imagen que se enviaba a formato PNG. Este formato fue el elegido porque tanto Unity como Android dan soporte de compresi\'on y descompresi\'on de manera eficaz. 



% Variable local para emacs, para  que encuentre el fichero maestro de
% compilaci�n y funcionen mejor algunas teclas r�pidas de AucTeX
%%%
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../ManualTeXiS.tex"
%%% End:
